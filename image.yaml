schema_version: 1

name: "jboss-kieserver-6/kieserver64-eap70-openshift"
version: "1.3"
from: "jboss-eap-7/eap70:7.0.9"
description: "Base image supporting `jboss-decisionserver-6/decisionserver64-eap70-openshift` and `jboss-decisionserver-6/processserver64-eap70-openshift`. This is not currently released or supported as an independent image for end-users."
labels:
    - name: "com.redhat.component"
      value: "jboss-kieserver-6-kieserver64-eap70-openshift-container"
    - name: "io.k8s.description"
      value: "Base platform for executing business rules and processes on JBoss BxMS KIE Server 6.4 on top of JBoss EAP 7.0.x."
    - name: "io.k8s.display-name"
      value: "JBoss BxMS KIE Server 6.4"
    - name: "io.openshift.tags"
      value: "builder,kieserver,kieserver6"
    - name: "io.openshift.s2i.scripts-url"
      value: "image:///usr/local/s2i"
envs:
    - name: "STI_BUILDER"
      value: "jee"
    - name: "JBOSS_MODULES_SYSTEM_PKGS"
      value: "org.jboss.logmanager,jdk.nashorn.api"
    - name: "DEFAULT_ADMIN_USERNAME"
      value: "eapadmin"
    - name: "JAVA_OPTS_APPEND"
      example: "-Dfoo=bar"
      description: "Server startup options."
    - name: "JBOSS_MODULES_SYSTEM_PKGS_APPEND"
      example: "org.jboss.byteman"
      description: "Comma-separated list of package names that will be appended to the JBOSS_MODULES_SYSTEM_PKGS environment variable."
    - name: "MQ_SIMPLE_DEAFAULT_PHYSICAL_DESTINATION"
      example: "false"
      description: "For backwards compatability, set to true to use 'MyQueue' and 'MyTopic' as physical destination name defaults instead of 'queue/MyQueue' and 'topic/MyTopic'."
    - name: "DEFAULT_JMS_CONNECTION_FACTORY"
      example: "java:jboss/DefaultJMSConnectionFactory"
      description: "Specify the default JNDI binding for the JMS connection factory (jms-connection-factory='java:jboss/DefaultJMSConnectionFactory')."
    - name: "CLI_GRACEFUL_SHUTDOWN"
      example: "true"
      description: "If set to any non zero length value then the image will prevent shutdown with the TERM signal and will require execution of the shutdown command through jboss-cli."
    - name: "SCRIPT_DEBUG"
      example: "true"
      description: "If set to true, ensurses that the bash scripts are executed with the -x option, printing the commands and their arguments as they are executed."
    - name: "JAVA_MAX_MEM_RATIO"
      example: "50"
      description: "This is used to calculate a default maximal heap memory based on a containers restriction. If used in a container without any memory constraints for the container then this option has no effect. If there is a memory constraint then `-Xmx` is set to a ratio of the container available memory as set here. The default is `50` which means 50% of the available memory is used as an upper boundary. You can skip this mechanism by setting this value to `0` in which case no `-Xmx` option is added."
    - name: "JAVA_INITIAL_MEM_RATIO"
      example: "100"
      description: "This is used to calculate a default initial heap memory based the maximal heap memory.  The default is `100` which means 100% of the maximal heap is used for the initial heap size.  You can skip this mechanism by setting this value to `0` in which case no `-Xms` option is added."
    - name: "JAVA_MAX_INITIAL_MEM"
      example: "4096"
      description: "The maximum size of the initial heap memory, if the calculated default initial heap is larger then it will be capped at this value.  The default is 4096 MB."
    - name: "JAVA_CORE_LIMIT"
      example: "2"
      description: "Core limit as described in https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt.  Used to configure the number of GC threads and parallelism for ForkJoinPool.  Defaults to container core limit."
    - name: "JAVA_DIAGNOSTICS"
      example: "true"
      description: "Set this to get some diagnostics information to standard output when things are happening. **Disabled by default.**"
    - name: "GC_MIN_HEAP_FREE_RATIO"
      example: "20"
      description: "Minimum percentage of heap free after GC to avoid expansion."
    - name: "GC_MAX_HEAP_FREE_RATIO"
      example: "40"
      description: "Maximum percentage of heap free after GC to avoid shrinking."
    - name: "GC_TIME_RATIO"
      example: "4"
      description: "Specifies the ratio of the time spent outside the garbage collection (for example, the time spent for application execution) to the time spent in the garbage collection."
    - name: "GC_ADAPTIVE_SIZE_POLICY_WEIGHT"
      example: "90"
      description: "The weighting given to the current GC time versus previous GC times."
    - name: "GC_MAX_METASPACE_SIZE"
      example: "100"
      description: "The maximum metaspace size."
    - name: "CUSTOM_INSTALL_DIRECTORIES"
      example: "custom,shared"
      description: "A list of comma-separated directories used for installation and configuration of artifacts for the image during the S2I process."
    - name: "CONTAINER_HEAP_PERCENT"
      example: "0.5"
      description: "Deprecated.  See JAVA_MAX_MEM_RATIO."
    - name: "INITIAL_HEAP_PERCENT"
      example: "0.5"
      description: "Deprecated.  See JAVA_INITIAL_MEM_RATIO."
    - name: "PROBE_DISABLE_BOOT_ERRORS_CHECK"
      example: "true"
      description: "Disable the boot errors check in the probes."
    - name: "ENABLE_ACCESS_LOG"
      example: "true"
      description: "Enable the Access Log."
    - name: "ENABLE_JSON_LOGGING"
      example: "true"
      description: "Enable JSON-formatted logging"
    - name: "KIE_CONTAINER_DEPLOYMENT"
      example: "containerId=groupId:artifactId:version|c2=g2:a2:v2'"
      description: "The KIE Containers to deploy. (optional)"
    - name: "KIE_CONTAINER_DEPLOYMENT_OVERRIDE"
      example: "containerId=groupId:artifactId:version|c2=g2:a2:v2'"
      description: "Used to override application template KIE_CONTAINER_DEPLOYMENT from .sti/environment. (optional)"
    - name: "KIE_CONTAINER_REDIRECT_ENABLED"
      example: "true"
      description: "Whether KIE Container alias ids will be redirected to generated deployment ids. (optional)"
    - name: "KIE_SERVER_BPM_DISABLED"
      example: "false"
      description: "Whether to disable the BPM capability. (optional)"
    - name: "KIE_SERVER_BPM_UI_DISABLED"
      example: "false"
      description: "Whether to disable the BPM UI capability. (optional)"
    - name: "KIE_SERVER_BRM_DISABLED"
      example: "false"
      description: "Whether to disable the BRM capability. (optional)"
    - name: "KIE_SERVER_BRP_DISABLED"
      example: "false"
      description: "Whether to disable the BRP capability. (optional)"
    - name: "KIE_SERVER_DOMAIN"
      example: "other"
      description: "JAAS LoginContext domain that shall be used to authenticate users when using JMS. (optional)"
    - name: "KIE_SERVER_EXECUTOR_POOL_SIZE"
      example: "1"
      description: "BPM Executor pool size. (optional)"
    - name: "KIE_SERVER_EXECUTOR_RETRY_COUNT"
      example: "3"
      description: "BPM Executor retry count. (optional)"
    - name: "KIE_SERVER_EXECUTOR_INTERVAL"
      example: "3"
      description: "BPM Executor interval. (optional)"
    - name: "KIE_SERVER_EXECUTOR_INITIAL_DELAY"
      example: "100"
      description: "BPM Executor initial delay. (optional)"
    - name: "KIE_SERVER_EXECUTOR_TIMEUNIT"
      example: "SECONDS"
      description: "BPM Executor timeunit. (optional)"
    - name: "KIE_SERVER_EXECUTOR_JMS"
      example: "true"
      description: "Whether to use JMS for BPM Executor. (optional)"
    - name: "KIE_SERVER_EXECUTOR_JMS_QUEUE"
      example: "queue/KIE.SERVER.EXECUTOR"
      description: "BPM JNDI name of executor queue for JMS. (optional)"
    - name: "KIE_SERVER_EXECUTOR_JMS_TRANSACTED"
      example: "false"
      description: "Whether to transact JMS for BPM Executor. (optional)"
    - name: "KIE_SERVER_FILTER_CLASSES"
      example: "true"
      description: "Whether remoteable classes in the kjar should be filtered. (optional)"
    - name: "KIE_SERVER_HOST"
      example: "localhost"
      description: "The host name to access the KIE Server REST interface. (optional)"
    - name: "KIE_SERVER_HT_CALLBACK"
      example: "custom"
      description: "BPM Human task callback type (mvel, ldap, db, jaas, props, custom). (optional)"
    - name: "KIE_SERVER_HT_CUSTOM_CALLBACK"
      example: "org.custom.MyUserGroupCallback"
      description: "BPM Human task custom callback class (implements UserGroupCallback). (optional)"
    - name: "KIE_SERVER_HT_USERINFO"
      example: "custom"
      description: "BPM Human task UserInfo type (ldap, db, props, custom). (optional)"
    - name: "KIE_SERVER_HT_CUSTOM_USERINFO"
      example: "org.custom.MyUserInfo"
      description: "BPM Human task custom userinfo class (implements UserInfo). (optional)"
    - name: "KIE_SERVER_ID"
      example: "kieserver"
      description: "The KIE Server identifier. (optional)"
    - name: "KIE_SERVER_JMS_QUEUES_REQUEST"
      example: "queue/KIE.SERVER.REQUEST"
      description: "JNDI name of request queue for JMS. (optional)"
    - name: "KIE_SERVER_JMS_QUEUES_RESPONSE"
      example: "queue/KIE.SERVER.RESPONSE"
      description: "JNDI name of response queue for JMS. (optional)"
    - name: "KIE_SERVER_MBEANS_ENABLED"
      example: "true"
      description: "Whether the KIE Server JMX MBeans should be enabled. (optional)"
    - name: "KIE_SERVER_PASSWORD"
      example: "kieserver1!"
      description: "The password to access the KIE Server REST or JMS interface. Must be different than username; must not be root, admin, or administrator; must contain at least 8 characters, 1 alphabetic character(s), 1 digit(s), and 1 non-alphanumeric symbol(s). (optional)"
    - name: "KIE_SERVER_PERSISTENCE_DIALECT"
      example: "org.hibernate.dialect.MySQL5Dialect"
      description: "BPM Hibernate persistence dialect. (optional)"
    - name: "KIE_SERVER_PERSISTENCE_DS"
      example: "java:/jboss/datasources/ExampleDS"
      description: "BPM Hibernate persistence datasource; will default to DB_JNDI. (optional)"
    - name: "KIE_SERVER_PERSISTENCE_TM"
      example: "org.hibernate.service.jta.platform.internal.JBossAppServerJtaPlatform"
      description: "BPM Hibernate persistence transaction manager. (optional)"
    - name: "KIE_SERVER_PORT"
      example: "8080"
      description: "The port to access the KIE Server REST interface. (optional)"
    - name: "KIE_SERVER_PROTOCOL"
      example: "http"
      description: "The protocol to access the KIE Server REST interface. (optional)"
    - name: "KIE_SERVER_USER"
      example: "kieserver"
      description: "The user name to access the KIE Server REST or JMS interface. (optional)"
    - name: "SCRIPT_DEBUG"
      description: "If set to true, ensurses that the bash scripts are executed with the -x option, printing the commands and their arguments as they are executed."
      example: "true"
    - name: "CUSTOM_INSTALL_DIRECTORIES"
      description: "A list of comma-separated directories used for installation and configuration of artifacts for the image during the S2I process."
      example: "custom,shared"
    - name: "BPMSUITE_BASE_VERSION"
      value: "6.4.0.GA"
      description: "BPM Suite base installation version."
    - name: "BPMSUITE_PATCH_VERSION"
      value: "6.4.9"
      description: "BPM Suite patch upgrade version."
    - name: "OPENSHIFT_KIESERVER_VERSION"
      value: "1.3.0.Final-redhat-1"
      description: "OpenShift KIE Server integration version."
ports:
    - value: 8080
    - value: 8443
    - value: 8778
modules:
      repositories:
          - git:
              url: https://github.com/jboss-openshift/cct_module.git
              ref: master
          - git:
              url: https://github.com/jboss-container-images/jboss-kie-modules.git
              ref: master
      install:
          - name: dynamic-resources
          - name: s2i-common
          - name: java-alternatives
          - name: os-eap7-openshift
          - name: os-eap-s2i
          - name: os-java-jolokia
          - name: jolokia
          - name: os-eap7-openshift
          - name: os-eap70-openshift
          - name: os-eap7-modules
          - name: os-eap70-modules
          - name: os-eap7-ping
          - name: os-eap-activemq-rar
          - name: os-java-run
          - name: os-eap-launch
          - name: os-eap7-launch
          - name: os-eap-logging
          - name: os-eap-probes
          - name: jboss-maven
          - name: os-eap-db-drivers
          - name: os-eap-sso
          - name: os-eap70-sso
          - name: os-java-hawkular
          - name: os-eap70-hawkular
          - name: os-eap-hawkular
          - name: os-eap-deployment-scanner
          - name: os-eap-extensions
          - name: openshift-layer
          - name: openshift-passwd
          - name: os-logging
          - name: os.kieserver.launch
          - name: os.kieserver.probes
          - name: os.kieserver.s2i
          - name: os.kieserver.webapp
          - name: os.kieserver.chmod
packages:
      repositories:
          - jboss-os
          - jboss-rhscl
      install:
          - rh-mongodb32-mongo-java-driver
          - postgresql-jdbc
          - mysql-connector-java
          - rh-maven33
          - hostname
          - python-requests
          - python-enum34
artifacts:
    - path: jboss-bpmsuite-6.4.0.GA-deployable-eap7.x.zip
      md5: a3d28eaf23495cb37e9ecd136dfb0c2d
    - path: jboss-bpmsuite-6.4.9.GA-supplementary-tools.zip
      md5: 0b6add72be1cd04c361b1d04ecc43779
    - path: jboss-bpmsuite-6.4.9-patch.zip
      md5: a24267deef7ace526c48c9ad8dae424d
    - path: openshift-kieserver-common-1.3.0.Final-redhat-1.jar
      md5: 22c7fa6adedc0c0ba1e8ff54f9ea57fd
    - path: openshift-kieserver-jms-1.3.0.Final-redhat-1.jar
      md5: 21234d8df9e0bce07b38d4ad6b01fc1a
    - path: openshift-kieserver-web-1.3.0.Final-redhat-1.jar
      md5: 9dbb2b125efbb692cabf614a670d7ca8
run:
      user: 185
      cmd:
          - "/opt/eap/bin/kieserver-launch.sh"
osbs:
      repository:
            name: containers/jboss-kieserver-6
            branch: jb-kieserver-6.4-eap70-rhel-7